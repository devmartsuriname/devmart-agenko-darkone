# Restore Point: Phase A12.10 — Home FunFacts CRUD

**Created:** 2025-12-20
**Phase:** A12.10
**Purpose:** Add CMS support for Home "FunFact / Stats" section (DB + RLS + Admin CRUD)

---

## Scope

- Create `home_funfacts` table with max 4 rows constraint
- Add RLS policies (Admin/Editor CRUD, Public read active)
- Create Admin CRUD module at `/frontend/sections/home/funfacts`
- Add menu item under Frontend → Sections → Home → "FunFacts"

## NOT in Scope

- Public frontend wiring (Phase A12.11)
- Site Settings integration
- Any other section modifications

---

## Current State (Before Change)

### Existing DB Tables (Content)

| Table | Purpose |
|-------|---------|
| `hero_sections` | Homepage heroes |
| `home_about_sections` | Home About sections |
| `services` | Service offerings |
| `projects` | Portfolio/projects |
| `blog_posts` | Blog articles |
| `pages` | Static/CMS pages |
| `team_members` | Team profiles |
| `testimonials` | Client testimonials |
| `awards` | Awards/recognition |
| `faqs` | FAQ entries |
| `contact_submissions` | Contact form data |
| `newsletter_subscribers` | Newsletter signups |
| `site_settings` | Global branding |
| `user_profiles` | User info |
| `user_roles` | RBAC roles |

### Admin Nav (Frontend → Sections → Home)

Current children:
1. Hero Sections (`/content/hero`)
2. About Sections (`/frontend/sections/home/about`)

After this phase:
3. FunFacts (`/frontend/sections/home/funfacts`) ← NEW

### Files to Create

| File | Purpose |
|------|---------|
| `apps/admin/src/app/(admin)/frontend/sections/home/funfacts/page.tsx` | List page |
| `apps/admin/src/app/(admin)/frontend/sections/home/funfacts/components/FunFactForm.tsx` | Create/Edit modal |
| `apps/admin/src/app/(admin)/frontend/sections/home/funfacts/components/FunFactDeleteModal.tsx` | Delete confirmation |

### Files to Modify

| File | Change |
|------|--------|
| `apps/admin/src/routes/index.tsx` | Add route for funfacts page |
| `apps/admin/src/assets/data/menu-items.ts` | Add menu item under Home |
| `docs/backend.md` | Add A12.10 phase entry |
| `docs/architecture.md` | Add A12.10 phase entry |

---

## New Table Schema

```sql
CREATE TABLE public.home_funfacts (
  id uuid NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by uuid REFERENCES auth.users(id),
  updated_by uuid REFERENCES auth.users(id),
  is_active boolean NOT NULL DEFAULT true,
  sort_order integer NOT NULL DEFAULT 0,
  title text NOT NULL,
  number text NOT NULL
);
```

### Max 4 Rows Constraint

Implemented via trigger function that prevents INSERT when count >= 4.

### RLS Policies

- Admin/Editor: SELECT, INSERT, UPDATE, DELETE (all active)
- Public: SELECT where is_active = true

---

## Rollback Instructions

1. Drop table: `DROP TABLE IF EXISTS public.home_funfacts;`
2. Drop function: `DROP FUNCTION IF EXISTS public.check_home_funfacts_max_rows();`
3. Remove route from `apps/admin/src/routes/index.tsx`
4. Remove menu item from `apps/admin/src/assets/data/menu-items.ts`
5. Delete folder: `apps/admin/src/app/(admin)/frontend/sections/home/funfacts/`
6. Revert docs changes

---

## Verification Checklist (Post-Implementation)

| Item | Status |
|------|--------|
| Restore point created | ⬜ |
| Migration applied successfully | ⬜ |
| "Max 4" enforced (5th insert blocked) | ⬜ |
| RLS enabled + policies verified | ⬜ |
| Admin route works (no console errors) | ⬜ |
| CRUD works (create/edit/toggle/delete) | ⬜ |
| Sorting works (sort_order asc) | ⬜ |
| No unintended changes to apps/public UI | ⬜ |
| Docs updated | ⬜ |
