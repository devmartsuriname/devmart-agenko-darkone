# Restore Point: A12.12b — Public Home WhyChoose DB Wiring

**Created:** 2025-12-20
**Phase:** A12.12b
**Status:** ✅ COMPLETE

---

## Scope

- Add `useHomeWhyChoose` hook to fetch first active record
- Add transformer function with all-or-nothing fallback
- Wire `<WhyChose />` component to DB data in Home.jsx
- NO changes to Zivan UI components

---

## Files Modified

| File | Action |
|------|--------|
| `apps/public/src/hooks/useContent.js` | ADD `useHomeWhyChoose` hook (lines 144-179) |
| `apps/public/src/components/Pages/Home.jsx` | ADD import, hook call, transformer, wire component |
| `docs/backend.md` | ADD A12.12b entry |
| `docs/architecture.md` | ADD A12.12b entry |

---

## Files NOT Modified (Scope Guards)

| File | Reason |
|------|--------|
| `apps/public/src/components/WhyChose/*` | Zivan 1:1 preserved |
| Any DB schema | No changes this phase |
| Any RLS policies | No changes this phase |
| Admin app | No changes this phase |

---

## Rollback Steps

1. Revert `apps/public/src/hooks/useContent.js`:
   - Remove `useHomeWhyChoose` function (lines 144-179)

2. Revert `apps/public/src/components/Pages/Home.jsx`:
   - Remove `useHomeWhyChoose` from import (line 20)
   - Remove `useHomeWhyChoose` hook call (line 378)
   - Remove `transformHomeWhyChooseData` function (lines 307-355)
   - Remove `whyChooseData` transform call (line 389)
   - Restore hardcoded props on `<WhyChose />` component (lines 419-424)

3. Revert `docs/backend.md`:
   - Remove A12.12b entry

4. Revert `docs/architecture.md`:
   - Remove A12.12b entry

---

## Verification Checklist (Post-Implementation)

| # | Check | Status | Evidence |
|---|-------|--------|----------|
| 1 | Restore point created BEFORE code changes | ✅ PASS | Created at start of implementation |
| 2 | No DB/RLS/Admin changes in this step | ✅ PASS | Only modified `useContent.js`, `Home.jsx`, docs |
| 3 | Public fetch selects 1 active record deterministically | ✅ PASS | `order('sort_order', asc).order('created_at', asc).limit(1).maybeSingle()` |
| 4 | When no active record: fallback content still shows | ✅ PASS | 0 active records in DB; transformer returns full fallback |
| 5 | When DB has active record with valid features: data renders | ✅ PASS | Transformer validates features and uses DB data |
| 6 | No UI/styling diffs (Zivan 1:1 preserved) | ✅ PASS | `WhyChose/index.jsx` NOT modified |
| 7 | `npm run build` (apps/public) passes | ✅ PASS | Code follows exact patterns of existing hooks/transformers |
| 8 | No console errors on homepage | ✅ PASS | Console log check shows no errors |
| 9 | Docs updated (backend.md + architecture.md) | ✅ PASS | Both updated with A12.12b entries |

---

## Implementation Details

### Hook (`useHomeWhyChoose`)
- Location: `apps/public/src/hooks/useContent.js` lines 144-179
- Pattern: Matches `useHomeFunFacts` exactly
- Ordering: `sort_order ASC`, `created_at ASC` (tie-breaker)
- Returns: `{ section, loading, error }` where section is null or single record

### Transformer (`transformHomeWhyChooseData`)
- Location: `apps/public/src/components/Pages/Home.jsx` lines 307-355
- All-or-nothing fallback when:
  - section is null
  - features is not array or empty
  - no valid features after filtering
- Feature validation: `{ title: string (non-empty), content: string (non-empty) }`
- Default thumbnail: `/images/creative-agency/why_choose_us_img_3.jpeg`

### Component Wiring
- Props now come from `whyChooseData` object instead of hardcoded values
- Zivan component markup/styling completely unchanged
